<?php

/**
 * @file
 * Contains dashpage.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\node\Entity\Node;

/**
 * @Implements hook_help().
 */
function dashpage_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the dashpage module.
    case 'help.page.dashpage':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Custom layout page') . '</p>';
      return $output;

    default:
  }
}

/**
 * @Implements hook_page_attachments()
 *
 */
function dashpage_page_attachments(array &$page) {
  // if (!\Drupal::currentUser()->hasPermission('access contextual links')) {
  //   return;
  // }

  $page['#attached']['library'][] = 'dashpage/dashpage-page-style';
  $page['#attached']['library'][] = 'dashpage/dashpage-global-styling';
  $page['#attached']['library'][] = 'dashpage/fontawesome-free';

  return;
}

/**
 * Implements hook_theme().
 */
function dashpage_theme() {
  return [
    'index_carousel_block' => [
      'variables' => [
        'carouselrows' => [],
      ],
      'template' => 'index-carousel-block',
    ],
    'feature_product_block' => [
      'variables' => [
        'details' => [],
        'productlogos' => [],
      ],
      'template' => 'feature-product-block',
    ],
    'feature_first_block' => [
      'variables' => [
        'solutions' => [],
      ],
      'template' => 'feature-first-block',
    ],
    'feature_third_block' => [
      'variables' => [
        'features' => [
          [
            'icon' => '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>',
            'title' => t('5G Ultra-High-Speed Transmission'),
            'description' => t('Leverages 5G networks to achieve ultra-high-speed data transmission, ensuring stable and high-quality real-time video streaming.'),
          ],
          [
            'icon' => '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg>',
            'title' => t('Multi-Device Support'),
            'description' => t('Supports multiple devices, including cameras, smartphones, and tablets, to meet live streaming requirements across different scenarios.'),
          ],
          [
            'icon' => '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',
            'title' => t('Cloud-Based Management'),
            'description' => t('(Easily manage live content through a cloud-based platform with real-time monitoring and parameter adjustments.'),
          ],
          [
            'icon' => '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>',
            'title' => t('High-Definition Video Streaming'),
            'description' => t('Supports 4K high-definition video streaming, delivering an exceptional visual experience for professional live production.'),
          ],
          [
            'icon' => '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
            'title' => t('Multi-Platform Distribution'),
            'description' => t('Supports one-click distribution of live content to multiple platforms, including YouTube, Facebook, and Twitch.'),
          ],
          [
            'icon' => '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',
            'title' => t('Real-Time Data Analytics'),
            'description' => t('Provides real-time analytics to help you understand audience behavior and live streaming performance.'),
          ],
        ],
        'news' => _get_latest_news(),
      ],
      'template' => 'feature-third-block',
    ],
  ];
}

/**
 * Get the last 6 news articles.
 */
function _get_latest_news() {
  $query = \Drupal::entityQuery('node')
    ->condition('type', 'article')
    ->condition('field_article_news', NULL, 'IS NOT NULL')
    ->sort('created', 'DESC')
    ->range(0, 6);
  $nids = $query->execute();

  $articles = [];
  foreach ($nids as $nid) {
    $node = Node::load($nid);
    $articles[] = [
      'title' => $node->getTitle(),
      'src' => Drupal::service('path_alias.manager')->getAliasByPath('/node/' . $node->id()),
    ];
  }

  return $articles;
}
